<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grade Calculator</title>
    <link rel="stylesheet" href="static/styles.css">
    <script src="https://pyscript.net/latest/pyscript.js"></script>
</head>
<body>
    <img class="background_img" src="images/gingham5.webp">

    <div class="container">
        <h1>Grade Calculator</h1>

        <form id="grade-form" onsubmit="handleSubmit(event)">
            <label for="prelim">Prelim Grade:</label>
            <input type="number" id="prelim" name="prelim" min="0" max="100" step="0.01" required placeholder="Enter Prelim Grade: (0-100)">
            <button type="submit">Calculate</button>
        </form>
        
        <div id="error-message"></div>
        <div id="result-message"></div>

        <py-script>
            from js import document, window

            def perform_calculations(prelim):
                # Weight of each grading component
                prelim_weight = 0.2
                midterm_weight = 0.3
                final_weight = 0.5
                passing_grade = 75
                deans_list_grade = 90

                # Calculate required grades
                required_midterm = (passing_grade - (prelim * prelim_weight)) / (midterm_weight + final_weight)
                required_final = (passing_grade - (prelim * prelim_weight) - (required_midterm * midterm_weight)) / final_weight

                can_pass = 0 <= required_midterm <= 100 and 0 <= required_final <= 100

                deans_midterm = (deans_list_grade - (prelim * prelim_weight)) / (midterm_weight + final_weight)
                deans_final = (deans_list_grade - (prelim * prelim_weight) - (deans_midterm * midterm_weight)) / final_weight
                deans_list_possible = deans_midterm <= 100 and deans_final <= 100

                # Prepare result message
                result_message = f"""
                    <h2>Results</h2>
                    <p><strong>Prelim Grade: {prelim}</strong></p>
                    <p>__________________________________________________________</p>
                    <h3>{"You have a chance to pass!" if can_pass else "It is difficult to pass."}</h3>
                    <h4>To pass with a minimum grade of 75%, aim for the required grades below:</h4>
                    <p><strong>Required Midterm Grade: {required_midterm:.2f}</strong></p>
                    <p><strong>Required Final Grade: {required_final:.2f}</strong></p>
                    <p>__________________________________________________________</p>
                    <h3>Dean's Lister Status</h3>
                    <h4>{"To qualify for the Dean's List (90% subject grade), achieve the following this semester:" if deans_list_possible else "Unfortunately, it's not possible for you to be a Dean's Lister."}</h4>
                    <p><strong>Required Midterm Grade: {'N/A' if not deans_list_possible else deans_midterm:.2f}</strong></p>
                    <p><strong>Required Final Grade: {'N/A' if not deans_list_possible else deans_final:.2f}</strong></p>
                """
                return result_message

            # Expose the function to JavaScript
            window.perform_calculations = perform_calculations
        </py-script>

        <script>
            // Function to handle form submission
            async function handleSubmit(event) {
                // Prevent the default form submission behavior
                event.preventDefault();

                // Get the prelim grade input from the user
                const prelimInput = document.getElementById("prelim").value;
                const prelimGrade = parseFloat(prelimInput); // Convert input to a number

                // Call the Python function to perform calculations
                const results = await window.perform_calculations(prelimGrade);

                // Update the result message in the HTML
                document.getElementById("result-message").innerHTML = results;
                document.getElementById("error-message").innerHTML = ""; // Clear any previous error messages

                // Clear the input field after submission
                document.getElementById("prelim").value = "";
            }
        </script>
    </div>
</body>
</html>
