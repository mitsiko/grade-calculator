<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grade Calculator</title>
    <link rel="stylesheet" href="static/styles.css">
    <link rel="stylesheet" href="https://pyscript.net/latest/pyscript.css" />
    <script defer src="https://pyscript.net/latest/pyscript.js"></script>
</head>
<body>
    <div class="container">
        <h1>Grade Calculator</h1>
        <form id="grade-form">
            <label for="prelim">Enter Prelim Grade (0-100):</label>
            <input type="number" id="prelim" name="prelim" min="0" max="100" step="0.01" required>
            <button type="submit">Calculate</button>
        </form>
        <div id="error" class="error" style="display: none;"></div>
        <div id="result" class="result" style="display: none;"></div>
    </div>

    <!-- Python Code inside PyScript -->
    <py-script>
        def calculate_grades(prelim):
            prelim_weight = 0.2
            midterm_weight = 0.3
            final_weight = 0.5
            passing_grade = 75
            deans_list_grade = 90

            required_midterm = (passing_grade - (prelim * prelim_weight)) / (midterm_weight + final_weight)
            required_final = (passing_grade - (prelim * prelim_weight) - (required_midterm * midterm_weight)) / final_weight

            can_pass = 0 <= required_midterm <= 100 and 0 <= required_final <= 100

            deans_midterm = (deans_list_grade - (prelim * prelim_weight)) / (midterm_weight + final_weight)
            deans_final = (deans_list_grade - (prelim * prelim_weight) - (deans_midterm * midterm_weight)) / final_weight

            deans_list_possible = deans_midterm <= 100 and deans_final <= 100

            return {
                "required_midterm": round(required_midterm, 2),
                "required_final": round(required_final, 2),
                "can_pass": can_pass,
                "deans_midterm": round(deans_midterm, 2),
                "deans_final": round(deans_final, 2),
                "deans_list_possible": deans_list_possible
            }

        def show_result(prelim):
            result_div = Element("result")
            error_div = Element("error")

            # Perform the calculation
            try:
                prelim = float(prelim)
                if prelim < 0 or prelim > 100:
                    error_div.element.innerText = "Please enter a valid prelim grade between 0 and 100."
                    error_div.element.style.display = "block"
                    result_div.element.style.display = "none"
                else:
                    result = calculate_grades(prelim)
                    result_text = f"Required Midterm Grade: {result['required_midterm']}, Required Final Grade: {result['required_final']}"
                    result_div.element.innerText = result_text
                    result_div.element.style.display = "block"
                    error_div.element.style.display = "none"
            except ValueError:
                error_div.element.innerText = "Please enter a numeric value for the prelim grade."
                error_div.element.style.display = "block"
                result_div.element.style.display = "none"

    </py-script>

    <!-- Wait for PyScript to load and use it inside JS -->
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            document.getElementById("grade-form").onsubmit = (event) => {
                event.preventDefault();
                const prelim = document.getElementById("prelim").value;

                // Call the PyScript function
                pyscript.interpreter.globals.get('show_result')(prelim);
            };
        });
    </script>
</body>
</html>
